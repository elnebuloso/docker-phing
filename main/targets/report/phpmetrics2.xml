<?xml version="1.0" encoding="UTF-8"?>


<project default="report:phpmetrics2">


    <target name="report:phpmetrics2:init" depends="commons:init">
        <property name="reportPhpMetrics2Description" value="phpmetrics version 2 scanner"/>
        <property name="reportPhpMetrics2OutputTmp" value="${projectDirMain}/.phpmetrics2"/>
        <property name="reportPhpMetrics2Output" value="${projectDirBuildReports}/phpmetrics2"/>
    </target>


    <target name="report:phpmetrics2:help" depends="report:phpmetrics2:init">
        <echo message="${reportPhpMetrics2Description}"/>
    </target>


    <target name="report:phpmetrics2" depends="report:phpmetrics2:init, report:phpmetrics2:before, report:phpmetrics2:main, report:phpmetrics2:after">
        <echo message="successful"/>
    </target>


    <target name="report:phpmetrics2:before" hidden="true">
        <echo message="no actions defined"/>
    </target>


    <target name="report:phpmetrics2:after" hidden="true">
        <echo message="no actions defined"/>
    </target>


    <target name="report:phpmetrics2:main">
        <fail unless="reportPhpMetricsDirectories" message="missing property reportPhpMetricsDirectories"/>
        <my-php-metrics2-directories included="reportPhpMetrics2Included" dir="${projectDirMain}"/>

        <delete dir="${reportPhpMetrics2OutputTmp}"/>
        <mkdir dir="${reportPhpMetrics2OutputTmp}"/>

        <delete dir="${reportPhpMetrics2Output}"/>
        <mkdir dir="${reportPhpMetrics2Output}"/>

        <exec executable="phpmetrics2" passthru="true" checkreturn="true" level="info" dir="${projectDirMain}">
            <arg line="--report-html=${reportPhpMetrics2OutputTmp}"/>
            <arg line="--report-csv=${reportPhpMetrics2OutputTmp}/phpmetrics2.csv"/>
            <arg line="--report-json=${reportPhpMetrics2OutputTmp}/phpmetrics2.json"/>
            <arg line="--report-violations=${reportPhpMetrics2OutputTmp}/phpmetrics2-violations.xml"/>
            <arg line="${reportPhpMetrics2Included}"/>
        </exec>

        <copy todir="${reportPhpMetrics2Output}">
            <fileset dir="${reportPhpMetrics2OutputTmp}">
                <include name="**/**"/>
            </fileset>
        </copy>

        <delete dir="${reportPhpMetrics2OutputTmp}"/>
    </target>


</project>
